<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>我抓娃娃机</title>
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, minimal-ui">
  <meta content="yes" name="apple-mobile-web-app-capable">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta content="black" name="apple-mobile-web-app-status-bar-style">
  <meta name="format-detection" content="telephone=no">
  <meta name="full-screen" content="yes">
  <meta name="x5-fullscreen" content="true">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Cache-control" content="no-cache">
  <meta http-equiv="Cache" content="no-cache">
  <link rel="stylesheet" href="http://res.catchme.com.cn/web/activity/js/layer.css"/>
  <script>
    (function (doc, win) {
      var clientWidth = win.innerWidth
        || doc.documentElement.clientWidth
        || doc.body.clientWidth;
      var docEl = doc.documentElement;
      var resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize';
      var recalc = function () {
        if (!clientWidth) return
        docEl.style.fontSize = 100 * (clientWidth / 750) + 'px'
      };

      if (!doc.addEventListener) return;
      win.addEventListener(resizeEvt, recalc, false)
      doc.addEventListener('DOMContentLoaded', recalc, false)
    })(document, window)
  </script>
  <style type="text/css">
    html, body, div,h1,h2,h3,h4,h5,h6 {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      width: 100%;
      height: 100%;
      position: relative;
    }
    .box {
      width: 100%;
      height: 100%;
      /*height: calc(100% - 1.28rem);*/
      position: absolute;
      background: url("http://res.catchme.com.cn/activity/free/bg.png") no-repeat;
      background-size: 100% 100%;
      visibility: hidden;
    }
    .box1 {
      z-index: 3;
    }
    .box2 {
      z-index: 2;
    }
    .box3 {
      z-index: 2;
    }
    .box .main{
      width: 100%;
      height: calc(100% - 2.9rem);
      position: relative;
    }
    .box .main >div{
      position: absolute;
      left: 50%;
      top:50%;
      transform: translate(-50%,-50%);
    }
    /*.box3 .main >div{*/
      /*margin: 0.6rem 0 0 0;*/
    /*}*/
    .box1 .main >div>img{
      width: 6.91rem;
      display: block;
      margin:0 auto 0.1rem auto;
    }

    .btn{
      width: 4.6rem;
      height: 0.94rem;
      position: absolute;
      border-radius: 0.1rem;
      background: #374cc6;
      border: 3px solid #25edff;
      box-shadow: 4px 4px 0.24rem rgba(28,39,98,0.4),-4px -4px 0.24rem rgba(28,39,98,0.4);
      font-size: 0.36rem;
      color: #fff;
      left: 50%;
      bottom: 1.96rem;
      transform: translateX(-50%);
      display: block;
      margin:0 auto;
      outline: none;
    }

    .box2 .main >div >img{
      width: 6.91rem;
      display: block;
      margin: 0 auto 0.1rem auto;
    }

    .box2 >div h3{
      width: 100%;
      font-size:0.42rem;
      color: #25edff;
      position: absolute;
      line-height: 0.42rem;
      top: 2.76rem;
      left: 0;
      text-align: center;
      letter-spacing: 3px;
    }
    .box2 h3 span{
      font-size: 0.6rem;
      color: #fa8e3f;
    }
    .box2 div>span{
      position: absolute;
      color: #fa8e3f;
      font-size: 0.63rem;
      top:6.3rem;
      left: 50%;
      font-weight: 600;
      text-align: center;
      line-height: 0.63rem;
    }

    .box2>p,.box3>p{
      font-size: 0.22rem;
      color: rgba(255,255,255,0.9);
      position: absolute;
      bottom: 0.8rem;
      left: 0;
      width: 100%;
      text-align: center;
      line-height: 0.32rem;
    }

    .box3 .main >div>img{
      width: 4.7rem;
      display: block;
      margin:0 auto;
    }
    .box3 h3{
      font-size: 0.32rem;
      text-align: center;
      color: #25edff;
      width: 100%;
      margin: 0 0 1.12rem 0;
      font-weight: normal;
    }
    .tip{
      position: fixed;
      left:0;
      top:0;
      width: 100%;
      height:100%;
      z-index: 4;
      visibility: hidden;
    }
    .tip img{
      width: 100%;
      height: 100%;
    }
    .high{
      z-index: 999;
      visibility: visible;
    }
    /*.top{*/
      /*height: 1.28rem;*/
      /*background: black;*/
    /*}*/
  </style>
</head>
<body>
<!--<div class="top"></div>-->
<div class="tip">
  <img src="http://res.catchme.com.cn/activity/guide/image_free2.png" alt="">
</div>
<div class="box box1 ">
  <div class="main">
   <div>
     <img src="http://res.catchme.com.cn/activity/free/box1.png" alt="">
   </div>
  </div>
  <button class="btn btn1">立即领取</button>
</div>
<div class="box box2 ">
  <div class="main">
    <div>
      <img src="http://res.catchme.com.cn/activity/free/box2.png" alt="">
      <h3>恭喜您获得<span class="s1">2</span>个游戏币</h3>
      <span class="s2">2币</span>
    </div>
  </div>
  <button class="btn btn2" onclick="closePage()">去抓娃娃</button>
  <p>使用方法：点击“去抓娃娃”按钮，<br/>关闭公众号对话框，投币开始游戏。</p>
</div>
<div class="box box3 ">
  <div class="main">
   <div>
     <h3>本月已领取，下个月再来领哦～</h3>
     <img src="http://res.catchme.com.cn/activity/free/box3.png" alt="">
   </div>
  </div>
  <button class="btn btn3" onclick="closePage()">去抓娃娃</button>
  <p>使用方法：点击“去抓娃娃”按钮，<br/>关闭公众号对话框，投币开始游戏。</p>
</div>
</body>
<!--<script type="text/javascript" src="http://res.catchme.com.cn/web/activity/js/unit.js"></script>-->
<script src="./../js/unit.js"></script>
<script type="text/javascript" src="http://res.catchme.com.cn/web/activity/js/layer.js"></script>
<script type="text/javascript">
  var dd = localStorage.getItem('encrypt')
  console.log(dd)
  window.onload = function () {
    var CONFIG = {
      ua: IsWeixinOrAlipay(),
      url: getUrl(),
    }
//    http://res.catchme.com.cn/activity/guide/image_free2.png
    //获取token
    callbackUrl(CONFIG);
//    配置jssdk
    getJssdk(CONFIG);

    var ok = getParamByName('ok');
    var token = getParamByName('token') || GetCookie('token_');
    if(ok || token){
      var box1 = document.querySelector('.box1');
      box1.className = 'box box1 high';
    }else {
      if(ok === false){
        var tip = document.querySelector('.tip');
        var clientWidth = window.innerWidth
          || document.documentElement.clientWidth
          || document.body.clientWidth;
        var clientHeight = window.innerHeight
          || document.documentElement.clientHeight
          || document.body.clientHeight;
        if (clientWidth / clientHeight <= 0.6) {
          var img = document.querySelector('.tip-bg')
          img.src = 'http://res.catchme.com.cn/activity/free/follow_long.png'
        }
        tip.className = 'tip high';
      }
    }

    var btn1 = document.querySelector('.btn1');
    var flag = false; //阻止重复点击按钮，多次发送请求

    var time = localStorage.getItem('receiveTime');

    btn1.onclick = function () {
      if (!flag) {
        var date = new Date();
        var nowTime = date.getMonth()+''+date.getDate();
        if(time === nowTime){
          var box3 = document.querySelector('.box3');
          box3.className = 'box box3 high';
          return;
        }
        var index = layer.open({type: 2});
        flag = true;
        ajax2({
          url: CONFIG.url + 'api/player/third',
//          url: 'http://front.5zhua.cn/api/free/order',
          method: 'POST',
          data: {
            third:getParamByName('re'),
            token: getParamByName('token') || GetCookie('token_')
          },
          success: function (response) {
            layer.close(index);
            if (typeof response === 'string') {
              response = JSON.parse(response);
            }
            if (response.status_code === 200) {
              var box2 = document.querySelector('.box2');
              box2.className = 'box box2 high';
            } else if (response.status_code === 1012) {
              var box3 = document.querySelector('.box3');
              box3.className = 'box box3 high';
            }
            else {
              CONFIG.isAble = false;
              layer.open({
                content: response.message
                , btn: '我知道了'
              });
            }
            localStorage.setItem('receiveTime',nowTime);
            flag = false;
          },
          error: function (err) {
            flag = false;
            layer.close(index);
            if(err.status_code === 429){
              layer.open({
                content: '访问过于频繁'
                , btn: '我知道了'
              });
              return;
            }
            layer.open({
              content: '网络出错，请重新扫描二维码'
              , btn: '我知道了'
            });
          }
        })
      }
    }

    function closePage() {
      var ua = IsWeixinOrAlipay()
      if (ua === 'WeiXin') {
        wx.closeWindow();
      } else {
        ap.popWindow();
      }
    }
  }
</script>
</html>
